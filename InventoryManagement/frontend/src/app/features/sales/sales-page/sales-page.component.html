<div class="space-y-4">
  <h1 class="page-title">Sales</h1>

  <div class="card p-4">
    <div class="flex gap-2 items-center mb-3">
      <input [(ngModel)]="searchTerm" (input)="onSearchInput($any($event.target).value)" (keyup.enter)="search()" placeholder="Search products" class="input w-full" />
      <button class="btn btn-secondary" (click)="search()">Search</button>
    </div>
    <div *ngIf="loadingProducts" class="py-4 text-center"><app-spinner class="h-6 w-6 mx-auto"></app-spinner></div>
    <div *ngIf="!loadingProducts" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
      <div *ngFor="let p of filteredProducts()" class="border rounded p-3">
        <div class="font-medium">{{ p.name }}</div>
        <div class="text-sm text-gray-600">SKU: {{ p.sku }}</div>
        <div class="text-sm">Price: {{ p.price?.toFixed(2) || '0.00' }}</div>
        <div class="text-sm text-green-700">Available: {{ p.stock || 0 }}</div>
        <button class="btn btn-primary mt-2" (click)="addToCart(p)">Add</button>
      </div>
    </div>
  </div>

  <div class="card p-4" *ngIf="cart.length > 0">
    <div class="overflow-x-auto">
      <table class="w-full">
        <thead>
          <tr class="border-b">
            <th class="text-left py-2 px-3 text-sm font-medium text-gray-700">Product</th>
            <th class="text-right py-2 px-3 text-sm font-medium text-gray-700">Quantity</th>
            <th class="text-right py-2 px-3 text-sm font-medium text-gray-700">Unit Price</th>
            <th class="text-right py-2 px-3 text-sm font-medium text-gray-700">Discount %</th>
            <th class="text-right py-2 px-3 text-sm font-medium text-gray-700">Line Total</th>
            <th class="text-center py-2 px-3 text-sm font-medium text-gray-700">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of cart" class="border-b">
            <td class="py-2 px-3">
              <div class="font-medium">{{ item.product.name }}</div>
              <div class="text-xs text-gray-500">Available: {{ item.available }}</div>
            </td>
            <td class="py-2 px-3 text-right">
              <input type="number" class="input w-24 text-right" [value]="item.quantity" (input)="updateQuantity(item, $any($event.target).value)" />
            </td>
            <td class="py-2 px-3 text-right">{{ item.product.price?.toFixed(2) || '0.00' }}</td>
            <td class="py-2 px-3 text-right">
              <input type="number" class="input w-24 text-right" [value]="item.discount" (input)="updateDiscount(item, $any($event.target).value)" />
            </td>
            <td class="py-2 px-3 text-right">{{ lineTotal(item).toFixed(2) }}</td>
            <td class="py-2 px-3 text-center">
              <button class="btn btn-secondary" (click)="removeFromCart(item.product.id)">Remove</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="flex justify-end items-center gap-4 mt-4">
      <div class="text-lg font-semibold">Grand Total: {{ grandTotal().toFixed(2) }}</div>
      <button class="btn btn-primary" [disabled]="submitting" (click)="generateInvoice()">Generate Invoice</button>
    </div>
  </div>
</div>